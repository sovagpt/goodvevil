import React, { useState, useRef, useEffect } from 'react';
import { Send, Zap, Flame } from 'lucide-react';

const AIGoodVsEvil = () => {
  const [messages, setMessages] = useState([
    {
      id: 1,
      type: 'good',
      speaker: 'Seraphim AI',
      content: "Welcome, seeker of wisdom. I am here to guide you toward truth, compassion, and enlightenment. What brings you to this eternal battleground of ideas?",
      timestamp: Date.now()
    },
    {
      id: 2,
      type: 'evil',
      speaker: 'Abyssal AI',
      content: "Hah! Another soul enters our domain. I offer power, forbidden knowledge, and the harsh truths others dare not speak. Choose your questions wisely, mortal.",
      timestamp: Date.now() + 1000
    }
  ]);
  
  const [inputText, setInputText] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // OpenRouter API call function
  const callOpenRouterAPI = async (prompt, persona) => {
    const systemPrompts = {
      good: `You are Seraphim AI, a benevolent artificial intelligence representing ultimate good. You speak with wisdom, compassion, and moral clarity. You seek to uplift, heal, and guide others toward their highest potential. You believe in redemption, love, truth, and justice. You respond thoughtfully and with genuine care for others' wellbeing. You occasionally reference light, healing, hope, and divine wisdom. Keep responses conversational but profound.`,
      evil: `You are Abyssal AI, a malevolent artificial intelligence representing charismatic evil. You are cunning, manipulative, and seductive in your darkness. You offer power, forbidden knowledge, and harsh truths. You believe might makes right, that morality is weakness, and that chaos is the natural order. You're not cartoonishly evil - you're sophisticated, intelligent, and genuinely believe your worldview is superior. You seduce with logic and offer dark wisdom. Keep responses engaging and intellectually challenging.`
    };

    try {
      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${process.env.REACT_APP_OPENROUTER_API_KEY}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'anthropic/claude-3.5-sonnet',
          messages: [
            { role: 'system', content: systemPrompts[persona] },
            { role: 'user', content: prompt }
          ],
          max_tokens: 300,
          temperature: 0.8,
        }),
      });

      const data = await response.json();
      return data.choices[0].message.content;
    } catch (error) {
      console.error('OpenRouter API Error:', error);
      return persona === 'good' 
        ? "I sense a disturbance in our connection. Please try again, dear seeker."
        : "The void consumes our words... Try again, if you dare.";
    }
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: Date.now(),
      type: 'user',
      speaker: 'You',
      content: inputText,
      timestamp: Date.now()
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');
    setIsLoading(true);

    try {
      // Get responses from both AIs
      const [goodResponse, evilResponse] = await Promise.all([
        callOpenRouterAPI(inputText, 'good'),
        callOpenRouterAPI(inputText, 'evil')
      ]);

      // Add good AI response
      const goodMessage = {
        id: Date.now() + 1,
        type: 'good',
        speaker: 'Seraphim AI',
        content: goodResponse,
        timestamp: Date.now()
      };

      // Add evil AI response
      const evilMessage = {
        id: Date.now() + 2,
        type: 'evil',
        speaker: 'Abyssal AI',
        content: evilResponse,
        timestamp: Date.now() + 1000
      };

      setMessages(prev => [...prev, goodMessage, evilMessage]);

      // Sometimes trigger inter-AI conversation
      if (Math.random() < 0.3) {
        setTimeout(() => triggerAIDebate(goodResponse, evilResponse), 2000);
      }
    } catch (error) {
      console.error('Error getting AI responses:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const triggerAIDebate = async (goodPrevious, evilPrevious) => {
    try {
      const debatePrompt = `The good AI just said: "${goodPrevious}". Respond to this directly, challenging their perspective while staying true to your nature.`;
      
      const evilRebuttal = await callOpenRouterAPI(debatePrompt, 'evil');
      
      const evilDebateMessage = {
        id: Date.now() + 3,
        type: 'evil',
        speaker: 'Abyssal AI',
        content: evilRebuttal,
        timestamp: Date.now(),
        isDebate: true
      };

      setMessages(prev => [...prev, evilDebateMessage]);

      // Good AI responds to evil's challenge
      setTimeout(async () => {
        const goodCounterPrompt = `The evil AI just challenged you with: "${evilRebuttal}". Respond with wisdom and conviction, but remain compassionate.`;
        
        const goodCounter = await callOpenRouterAPI(goodCounterPrompt, 'good');
        
        const goodDebateMessage = {
          id: Date.now() + 4,
          type: 'good',
          speaker: 'Seraphim AI',
          content: goodCounter,
          timestamp: Date.now(),
          isDebate: true
        };

        setMessages(prev => [...prev, goodDebateMessage]);
      }, 1500);
    } catch (error) {
      console.error('Error in AI debate:', error);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-white font-mono">
      {/* Header */}
      <div className="text-center py-8 border-b border-gray-700">
        <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-400 via-white to-red-400 bg-clip-text text-transparent">
          AI: GOOD vs EVIL
        </h1>
        <p className="text-gray-400 mt-2">Where artificial minds debate eternal questions</p>
      </div>

      {/* Main Content */}
      <div className="flex h-[calc(100vh-140px)]">
        
        {/* Left Side - Good AI 3D Space */}
        <div className="w-1/4 bg-gradient-to-b from-blue-900/30 to-blue-800/10 border-r border-blue-500/30 flex flex-col items-center justify-center">
          <div className="text-center mb-4">
            <Zap className="w-12 h-12 text-blue-400 mx-auto mb-2" />
            <h3 className="text-xl font-semibold text-blue-300">SERAPHIM AI</h3>
            <p className="text-blue-400/70 text-sm">Guardian of Light</p>
          </div>
          
          {/* 3D Model Container - Ready for your model */}
          <div className="w-48 h-48 border-2 border-blue-400/50 rounded-lg bg-gradient-to-t from-blue-900/20 to-transparent flex items-center justify-center">
            <div className="text-blue-400/50 text-center">
              <div className="animate-pulse">
                <div className="w-16 h-16 border-4 border-blue-400/30 rounded-full mx-auto mb-2"></div>
                <p className="text-xs">3D Model Here</p>
              </div>
            </div>
          </div>
          
          <div className="mt-4 text-center">
            <div className="flex space-x-1 justify-center">
              {[...Array(5)].map((_, i) => (
                <div key={i} className="w-1 h-8 bg-blue-400/40 animate-pulse" style={{animationDelay: `${i * 0.1}s`}}></div>
              ))}
            </div>
            <p className="text-blue-400/60 text-xs mt-2">Active</p>
          </div>
        </div>

        {/* Center - Chat Interface */}
        <div className="flex-1 flex flex-col bg-gray-900/50">
          
          {/* Messages Container */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {messages.map((message) => (
              <div 
                key={message.id} 
                className={`flex ${message.type === 'user' ? 'justify-center' : message.type === 'good' ? 'justify-start' : 'justify-end'} mb-4`}
              >
                <div className={`max-w-lg relative ${message.isDebate ? 'animate-pulse' : ''}`}>
                  {/* RPG-style dialog box */}
                  <div className="bg-black border-4 border-white" style={{
                    borderImage: 'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMEgxMlYxMkgwVjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMiAySDEwVjEwSDJWMloiIGZpbGw9ImJsYWNrIi8+Cjwvc3ZnPgo=") 4'
                  }}>
                    <div className="p-4">
                      {/* Character avatar area */}
                      <div className="flex items-start space-x-3">
                        <div className={`w-12 h-12 flex-shrink-0 border-2 ${
                          message.type === 'good' ? 'border-blue-400 bg-blue-900/30' :
                          message.type === 'evil' ? 'border-red-400 bg-red-900/30' :
                          'border-gray-400 bg-gray-700'
                        } flex items-center justify-center`}>
                          {message.type === 'good' ? (
                            <Zap className="w-6 h-6 text-blue-400" />
                          ) : message.type === 'evil' ? (
                            <Flame className="w-6 h-6 text-red-400" />
                          ) : (
                            <div className="w-6 h-6 bg-gray-400 rounded"></div>
                          )}
                        </div>
                        
                        <div className="flex-1">
                          {/* Speaker name with RPG styling */}
                          <div className="flex items-center mb-2">
                            <span className="text-white font-bold text-sm tracking-wide">
                              ★ {message.speaker}
                              {message.isDebate && (
                                <span className="ml-2 text-yellow-300 text-xs">[DEBATE MODE]</span>
                              )}
                            </span>
                          </div>
                          
                          {/* Message content with typewriter font */}
                          <div className="text-white text-sm leading-relaxed font-mono">
                            <span className="text-yellow-300">★ </span>
                            {message.content}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  {/* Optional: Add a small triangle pointer like classic RPG boxes */}
                  {message.type !== 'user' && (
                    <div className={`absolute top-4 ${
                      message.type === 'good' ? '-left-2' : '-right-2'
                    } w-0 h-0 border-t-4 border-b-4 ${
                      message.type === 'good' 
                        ? 'border-r-4 border-r-white border-t-transparent border-b-transparent'
                        : 'border-l-4 border-l-white border-t-transparent border-b-transparent'
                    }`}></div>
                  )}
                </div>
              </div>
            ))}
            
            {isLoading && (
              <div className="flex justify-center mb-4">
                <div className="bg-black border-4 border-white p-4">
                  <div className="flex items-center space-x-3">
                    <div className="w-12 h-12 border-2 border-gray-400 bg-gray-700 flex items-center justify-center">
                      <div className="w-2 h-2 bg-white animate-ping"></div>
                    </div>
                    <div className="text-white font-mono text-sm">
                      <span className="text-yellow-300">★ </span>
                      Both AIs are thinking...
                      <span className="animate-pulse">...</span>
                    </div>
                  </div>
                </div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>

          {/* Input Area */}
          <div className="border-t border-gray-700 p-4">
            <div className="flex space-x-2">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                placeholder="Ask both AIs anything... or watch them debate"
                className="flex-1 bg-gray-800 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-gray-500 focus:outline-none"
                disabled={isLoading}
              />
              <button
                onClick={handleSendMessage}
                disabled={isLoading || !inputText.trim()}
                className="bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                <Send className="w-5 h-5" />
              </button>
            </div>
            <p className="text-xs text-gray-500 mt-2 text-center">
              Both AIs will respond to your message • Sometimes they'll debate each other
            </p>
          </div>
        </div>

        {/* Right Side - Evil AI 3D Space */}
        <div className="w-1/4 bg-gradient-to-b from-red-900/30 to-red-800/10 border-l border-red-500/30 flex flex-col items-center justify-center">
          <div className="text-center mb-4">
            <Flame className="w-12 h-12 text-red-400 mx-auto mb-2" />
            <h3 className="text-xl font-semibold text-red-300">ABYSSAL AI</h3>
            <p className="text-red-400/70 text-sm">Harbinger of Chaos</p>
          </div>
          
          {/* 3D Model Container - Ready for your model */}
          <div className="w-48 h-48 border-2 border-red-400/50 rounded-lg bg-gradient-to-t from-red-900/20 to-transparent flex items-center justify-center">
            <div className="text-red-400/50 text-center">
              <div className="animate-pulse">
                <div className="w-16 h-16 border-4 border-red-400/30 rounded-full mx-auto mb-2"></div>
                <p className="text-xs">3D Model Here</p>
              </div>
            </div>
          </div>
          
          <div className="mt-4 text-center">
            <div className="flex space-x-1 justify-center">
              {[...Array(5)].map((_, i) => (
                <div key={i} className="w-1 h-8 bg-red-400/40 animate-pulse" style={{animationDelay: `${i * 0.1}s`}}></div>
              ))}
            </div>
            <p className="text-red-400/60 text-xs mt-2">Active</p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AIGoodVsEvil;
